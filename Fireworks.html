<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fireworks Generator</title>
    <!-- Import a clean font for the instructions -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400&display=swap" rel="stylesheet">
    <style>
        /* Basic reset and full-screen setup */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            /* A dark night sky */
            background-color: #000;
        }

        /* The canvas will be our drawing surface */
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* Styling for the simple instructions */
        #instructions {
            position: absolute;
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.7);
            font-family: 'Inter', sans-serif;
            font-size: 16px;
            text-align: center;
            pointer-events: none; /* Allows clicking through the text */
            transition: opacity 1s ease-out 2s; /* Fade out after 2 seconds */
        }
    </style>
</head>
<body>
    <!-- The canvas element where all the magic happens -->
    <canvas id="fireworksCanvas"></canvas>
    
    <!-- Instructions text -->
    <div id="instructions">Click or Tap to launch a firework!</div>

    <script>
        // --- Setup ---
        const canvas = document.getElementById('fireworksCanvas');
        const ctx = canvas.getContext('2d');
        let fireworks = [];
        let particles = [];

        // --- Settings ---
        const gravity = 0.07; // How fast particles fall
        const drag = 0.97;      // Air resistance (lower = more drag)
        const particleCount = 120; // Particles per explosion
        const launchInterval = 1000; // Auto-launch every 1s

        // Set initial canvas size
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // --- Helper Functions ---
        
        /**
         * Returns a random number within a given range.
         * @param {number} min - The minimum value.
         * @param {number} max - The maximum value.
         * @returns {number} A random number between min and max.
         */
        function random(min, max) {
            return Math.random() * (max - min) + min;
        }

        /**
         * Creates a burst of particles at a specific location.
         * @param {number} x - The x-coordinate of the explosion.
         * @param {number} y - The y-coordinate of the explosion.
         * @param {number} hue - The base color (hsl hue) for the particles.
         */
        function createParticles(x, y, hue) {
            for (let i = 0; i < particleCount; i++) {
                particles.push(new Particle(x, y, hue));
            }
        }
        
        // --- Firework Class ---
        // This is the initial rocket that flies up
        class Firework {
            constructor(startX, startY, endX, endY) {
                this.x = startX;
                this.y = startY;
                this.endX = endX;
                this.endY = endY;
                
                // Calculate angle and velocity
                const angle = Math.atan2(endY - startY, endX - startX);
                const speed = random(10, 15); // High initial speed
                this.vx = Math.cos(angle) * speed;
                this.vy = Math.sin(angle) * speed;
                
                this.hue = random(0, 360); // Random color for this firework
                this.brightness = random(50, 70);
                this.alpha = 1;
                this.decay = random(0.005, 0.015); // How fast the rocket fades
                
                // Store trail points
                this.trail = [];
                this.trailLength = 3;
            }

            update() {
                // Add current position to the trail
                this.trail.push({ x: this.x, y: this.y });
                if (this.trail.length > this.trailLength) {
                    this.trail.shift(); // Remove the oldest point
                }
                
                // Move the firework
                this.x += this.vx;
                this.y += this.vy;
                
                // Apply gravity
                this.vy += gravity;
                
                // Apply simple air resistance
                this.vx *= 0.98;
                this.vy *= 0.98;
                
                // Fade out
                this.alpha -= this.decay;
                
                // Explode when it reaches its apex (velocity in y-direction is near 0 or positive)
                // or if it fades out completely
                if (this.vy >= 0.5 || this.alpha <= this.decay) {
                    // Create explosion
                    createParticles(this.x, this.y, this.hue);
                    // Mark for removal
                    this.alpha = 0; // This will trigger its removal
                }
            }

            draw() {
                // Draw the trail
                if (this.trail.length > 1) {
                    ctx.beginPath();
                    ctx.moveTo(this.trail[0].x, this.trail[0].y);
                    for (let i = 1; i < this.trail.length; i++) {
                        ctx.lineTo(this.trail[i].x, this.trail[i].y);
                    }
                    ctx.strokeStyle = `hsla(${this.hue}, 100%, ${this.brightness}%, ${this.alpha * 0.5})`;
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
                
                // Draw the main rocket head
                ctx.fillStyle = `hsla(${this.hue}, 100%, ${this.brightness}%, ${this.alpha})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // --- Particle Class ---
        // This is a single spark from the explosion
        class Particle {
            constructor(x, y, hue) {
                this.x = x;
                this.y = y;
                
                // Random angle and speed for the explosion
                const angle = random(0, Math.PI * 2);
                const speed = random(1, 8); // Explosion speed
                this.vx = Math.cos(angle) * speed;
                this.vy = Math.sin(angle) * speed;
                
                this.hue = hue; // Inherit color from the firework
                this.brightness = random(60, 80);
                this.alpha = 1; // Start fully visible
                this.decay = random(0.015, 0.03); // How fast it fades
                
                this.trail = [];
                this.trailLength = 5;
            }

            update() {
                // Add to trail
                this.trail.push({ x: this.x, y: this.y });
                if (this.trail.length > this.trailLength) {
                    this.trail.shift();
                }
                
                // Move particle
                this.x += this.vx;
                this.y += this.vy;
                
                // Apply gravity
                this.vy += gravity;
                
                // Apply drag
                this.vx *= drag;
                this.vy *= drag;
                
                // Fade out
                this.alpha -= this.decay;
            }

            draw() {
                // Draw the trail
                if (this.trail.length > 1) {
                    ctx.beginPath();
                    ctx.moveTo(this.trail[0].x, this.trail[0].y);
                    for (let i = 1; i < this.trail.length; i++) {
                        ctx.lineTo(this.trail[i].x, this.trail[i].y);
                    }
                    ctx.strokeStyle = `hsla(${this.hue}, 100%, ${this.brightness}%, ${this.alpha * 0.5})`;
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
                
                // Draw the particle head
                ctx.fillStyle = `hsla(${this.hue}, 100%, ${this.brightness}%, ${this.alpha})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // --- Animation Loop ---
        function animate() {
            // Request the next frame
            requestAnimationFrame(animate);

            // This is the trick: draw a semi-transparent black rectangle
            // over the whole canvas. This "fades" everything from the
            // previous frame, creating the beautiful trail effect.
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Update and draw all fireworks
            // Loop backwards to allow for safe removal (splice)
            for (let i = fireworks.length - 1; i >= 0; i--) {
                fireworks[i].update();
                fireworks[i].draw();
                
                // Remove if faded
                if (fireworks[i].alpha <= 0) {
                    fireworks.splice(i, 1);
                }
            }
            
            // Update and draw all particles
            for (let i = particles.length - 1; i >= 0; i--) {
                particles[i].update();
                particles[i].draw();
                
                // Remove if faded
                if (particles[i].alpha <= particles[i].decay) {
                    particles.splice(i, 1);
                }
            }
        }

        // --- Event Listeners ---
        
        // Launch on click/tap
        canvas.addEventListener('click', (e) => {
            const startX = canvas.width / 2; // Always launch from bottom-center
            const startY = canvas.height;
            const endX = e.clientX;
            const endY = e.clientY;
            
            fireworks.push(new Firework(startX, startY, endX, endY));
        });

        // Automatic launch function
        function autoLaunch() {
            const startX = canvas.width / 2;
            const startY = canvas.height;
            const endX = random(canvas.width * 0.2, canvas.width * 0.8); // Random x target
            const endY = random(canvas.height * 0.1, canvas.height * 0.4); // Random y target
            
            fireworks.push(new Firework(startX, startY, endX, endY));
        }

        // Fade out instructions
        setTimeout(() => {
            document.getElementById('instructions').style.opacity = '0';
        }, 4000);

        // --- Start ---
        setInterval(autoLaunch, launchInterval); // Start auto-launching
        animate(); // Start the animation loop
    </script>
</body>
</html>